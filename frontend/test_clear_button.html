<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ทดสอบปุ่มเคลียร์โต๊ะ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>ทดสอบปุ่มเคลียร์โต๊ะ</h2>
        
        <div class="alert alert-info">
            <strong>วิธีทดสอบ:</strong>
            <ol>
                <li>กดปุ่ม "ทดสอบฟังก์ชัน clearTable" เพื่อดูว่าฟังก์ชันมีอยู่หรือไม่</li>
                <li>กดปุ่ม "ทดสอบเคลียร์โต๊ะ 1" เพื่อทดสอบการเคลียร์โต๊ะจริง</li>
                <li>ดู Console (F12) เพื่อดู log และ error</li>
            </ol>
        </div>
        
        <div class="mb-3">
            <button type="button" class="btn btn-info me-2" onclick="testClearTableFunction()">
                ทดสอบฟังก์ชัน clearTable
            </button>
            
            <button type="button" class="btn btn-primary me-2" onclick="clearTable(1)">
                ทดสอบเคลียร์โต๊ะ 1
            </button>
            
            <button type="button" class="btn btn-warning me-2" onclick="testDirectAPI()">
                ทดสอบ API โดยตรง
            </button>
        </div>
        
        <div id="result" class="mt-3"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/admin.js"></script>
    
    <script>
        function testClearTableFunction() {
            const resultDiv = document.getElementById('result');
            
            console.log('Testing clearTable function...');
            
            if (typeof clearTable === 'function') {
                resultDiv.innerHTML = '<div class="alert alert-success">✅ ฟังก์ชัน clearTable พบแล้ว!</div>';
                console.log('✅ clearTable function exists');
            } else {
                resultDiv.innerHTML = '<div class="alert alert-danger">❌ ไม่พบฟังก์ชัน clearTable!</div>';
                console.error('❌ clearTable function not found');
            }
            
            // ตรวจสอบ window object
            if (typeof window.clearTable === 'function') {
                resultDiv.innerHTML += '<div class="alert alert-success">✅ window.clearTable พบแล้ว!</div>';
                console.log('✅ window.clearTable exists');
            } else {
                resultDiv.innerHTML += '<div class="alert alert-danger">❌ ไม่พบ window.clearTable!</div>';
                console.error('❌ window.clearTable not found');
            }
        }
        
        async function testDirectAPI() {
            const resultDiv = document.getElementById('result');
            
            try {
                console.log('Testing direct API call...');
                
                const response = await fetch('http://localhost:5000/api/tables/1/clear', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    resultDiv.innerHTML = '<div class="alert alert-success">✅ API เคลียร์โต๊ะสำเร็จ!</div>';
                    console.log('✅ Direct API call successful:', data);
                } else {
                    resultDiv.innerHTML = '<div class="alert alert-warning">⚠️ API ตอบกลับแต่ไม่สำเร็จ</div>';
                    console.warn('⚠️ API response not successful:', data);
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="alert alert-danger">❌ เกิดข้อผิดพลาดในการเรียก API</div>';
                console.error('❌ API call failed:', error);
            }
        }
        
        // ตรวจสอบเมื่อโหลดหน้า
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, checking functions...');
            testClearTableFunction();
        });
    </script>
</body>
</html>